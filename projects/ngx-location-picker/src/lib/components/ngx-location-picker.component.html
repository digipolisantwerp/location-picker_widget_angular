<div class="a-input" [class.has-map]="showMap">
  <div class="a-input__search" [class.has-sidebar]="hasSidebar">
    <div class="a-input__wrapper has-inline-addon">
      <input
        #leafletSearch
        id="leaflet-search"
        type="text"
        name="leaflet-search"
        [placeholder]="placeholder"
        [attr.aria-label]="textInputAriaLabel"
        [(ngModel)]="selectedLocation && selectedLocation.label"
        (ngModelChange)="onInputChange($event)"
        autocomplete="off"
        (blur)="didSearch = false"
      />
      <div class="inline-addon" *ngIf="showClearInputButton">
        <span *ngIf="searching" class="a-spinner a-spinner--s u-margin-right-xs"></span>
        <button
          *ngIf="!inputHasValue"
          class="a-button a-button--text a-button--s has-icon"
          type="button"
          (click)="emptyField()"
          [attr.aria-label]="clearInputAriaLabel"
        >
          <aui-icon name="ai-close"></aui-icon>
        </button>
      </div>
    </div>

    <div class="m-flyout m-flyout--full" [class.is-open]="didSearch">
      <div class="m-flyout__content">
        <small *ngIf="!hasResults && !searching; else results" class="no-results">{{ noResultsLabel }}</small>
        <ng-template #results>
          <ul class="a-list a-list--reset a-list--lined">
            <li
              *ngFor="let location of foundLocations; let ii = index"
              (click)="onLocationSelect(location)"
              [class.is-highlighted]="ii === highlightedLocationResult"
            >
              <p [innerHTML]="location.label | highlight: selectedLocation?.label"></p>
              <small>{{ location.layer }}</small>
            </li>
          </ul>
        </ng-template>
        <div
          *ngIf="!hasResults && pickedLocation && !searching"
          (click)="onLocationSelect(selectedLocation)"
          class="use-coordinate"
          [class.is-highlighted]="!hasResults && pickedLocation"
        >
          <p>{{ defaultOptionLabel }}</p>
          <small>{{ selectedLocation.label }}</small>
        </div>
      </div>
    </div>
    <div *ngIf="leafletNotification?.text">
      <div role="alertdialog" aria-live="assertive" class="m-location-picker__notification-panel m-alert m-alert--{{ leafletNotification.status }}">
        <p><aui-icon [name]="leafletNotification.icon"></aui-icon> {{ leafletNotification.text }}</p>
        <button
          class="a-button a-button--text a-button--{{ leafletNotification.status }} has-icon m-alert__close"
          aria-label="Close"
          (click)="closeNotification()"
        >
          <aui-icon name="ai-close"></aui-icon>
        </button>
      </div>
    </div>
  </div>
  <aui-location-viewer
    *ngIf="showMap"
    [leafletMap]="leafletMap"
    [(hasSidebar)]="hasSidebar"
    [geoApiBaseUrl]="geoApiBaseUrl"
    [showLayerManagement]="showLayerManagement"
    [showSelectionTools]="showSelectionTools"
    [showMeasureTools]="showMeasureTools"
    [showWhatIsHereButton]="showWhatIsHereButton"
    [supportingLayerOptions]="supportingLayerOptions"
    [operationalLayerOptions]="operationalLayerOptions"
    [filterLayers]="filterLayers"
    [tileLayer]="tileLayer"
    [defaultTileLayerLabel]="defaultTileLayerLabel"
    [class.is-picking]="pickLocationActive"
    (mouseover)="isCursorOnLeaflet(true)"
    (mouseout)="isCursorOnLeaflet(false)"
    (filteredResult)="onResultFiltered($event)">
    <div controls bottom left>
      <button
        type="button"
        class="a-button a-button--s has-icon u-margin-bottom-xs button-location-picking"
        (click)="pickLocationOnMap()"
        [class.is-active]="pickLocationActive"
        [attr.aria-label]="locationPickAriaLabel"
      >
        <aui-icon name="ai-pin-3"></aui-icon>
      </button>
    </div>
    <div controls bottom right>
      <button
        type="button"
        class="a-button a-button--s has-icon"
        [attr.aria-label]="locateMeAriaLabel"
        [disabled]="isLocating"
        (click)="getDeviceLocation()"
      >
        <aui-icon *ngIf="!isLocating" name="ai-compass-arrow"></aui-icon>
        <span *ngIf="isLocating" class="a-spinner a-spinner--s"></span>
      </button>
    </div>
    <div *ngIf="hasSidebar">
      <ng-content></ng-content>
    </div>
</aui-location-viewer>
</div>
